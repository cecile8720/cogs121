<!DOCTYPE html>
<html>

<head>
  <title>My Trips</title>

  <!-- Firebase initialization -->
  <script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyBU1zQlcACqaOhTPhsPNyQkh1RYFf2cdYU",
      authDomain: "collegeburnouts.firebaseapp.com",
      databaseURL: "https://collegeburnouts.firebaseio.com",
      projectId: "collegeburnouts",
      storageBucket: "collegeburnouts.appspot.com",
      messagingSenderId: "890814837618"
    };
    firebase.initializeApp(config);
  </script>


  <!-- references and links -->
  <link rel="stylesheet" type="text/css" href="css/index.css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- database callings and functions -->
  <script type="text/javascript">
  $(document).ready(() => {

    // NPS data retrieval for Yellowstone
    $.ajax({
      url: 'https://developer.nps.gov/api/v1/parks?q=Yellowstone&api_key=pEHcIgdfn7FtEcQa1aUUfUpOEr6c58GjQYKJ2YB2',
      type: 'GET',
      dataType: 'json',
      success: (data) => {
        console.log('you actually received some data', data);
        console.table(data.data);
        // display data on page
        $('#current-trip-name').html(data.data[1].fullName);
        $('#states').html(data.data[1].states);
        $('#des').html(data.data[1].description);
        $('#weather').html(data.data[1].weatherInfo);
      }
    });

    // NPS data retrieval for search inquiry
    $('#addLocation').click(() => {
      console.log("Clicked on search");
      // get search value and its URL request
      const requestURL = 'https://developer.nps.gov/api/v1/parks?q=' +
                        $('#locationBox').val() +
                        '&api_key=pEHcIgdfn7FtEcQa1aUUfUpOEr6c58GjQYKJ2YB2';

      // ajax call to server for request URL
      $.ajax({
        // ex URL: https://developer.nps.gov/api/v1/parks?q=Zion&api_key=pEHcIgdfn7FtEcQa1aUUfUpOEr6c58GjQYKJ2YB2
        url: requestURL,
        type: 'GET',
        dataType: 'json',
        success: (data) => {
          // display data to make sure it's correct
          console.log('You actually received some data', data);
          console.table(data.data);

          // match the search results with the correct park
          const searchVal = ($('#locationBox').val() + ' National Park').toUpperCase(); // change to upper case for comparison
          console.log(searchVal);

          let parkIndex = -1;
          // for loop to go through the data
          Object.keys(data.data).forEach((e) => {
            console.log(e + ' ->', data.data[e].fullName);
            if ((data.data[e].fullName).toUpperCase() == searchVal) {
              console.log('The correct index is: ' + e);
              parkIndex = e;
              // display correct information
              $('#current-trip-name').html(data.data[parkIndex].fullName);
              $('#states').html(data.data[parkIndex].states);
              $('#des').html(data.data[parkIndex].description);
              $('#weather').html(data.data[parkIndex].weatherInfo);
            }
          });
          // if park name not found
          // display this better!!
          if (parkIndex == -1) {
            $('#current-trip-name').html('Not Found');
            $('#states').html('Not Found');
            $('#des').html('Not Found');
            $('#weather').html('Not Found');
          }
        }
      });
    });


    // firebase code
    const database = firebase.database();
    //console.log("reached");
    database.ref('location/Yellowstone').set({description: 'Wyoming, 3,471 mi^2', hours: '7AM-11PM', contact: '(307) 344-7381'});
    database.ref('location/Zion').set({description: 'Utah, 229 mi^2', hours: '6AM-11PM', contact: '(435) 772-3256'});

  });
  </script>


</head>

<body>
  <a name="top"></a>
	<div>
    <!-- Hamburger menu -->
		<div class="header">
			<img id="hamburger" class="icon header" src="img/hamburger-menu.png">
			<h2 class="current-location">Current Location</h2>
			<img class="icon" src="img/location-icon.png">
			<a href="nature-finder.html"><img id="leaf-icon" class="icon header" src="img/leaf-icon.png"></a>
		</div>
    <!-- Navbar -->
    <div class="navbar">
      <a href="index.html" class="active"><img src="https://img.icons8.com/ios/40/000000/home-page.png"></a>
      <a href="map.html"><img src="https://img.icons8.com/wired/40/000000/map.png"></a>
      <a href="trail-list.html"><img src="https://img.icons8.com/ios/40/000000/earth-element.png"></a>
      <a href="photos.html"><img src="https://img.icons8.com/ios/40/000000/image.png"></a>
    </div>
	</div>

	<hr>

	<div class="content">
		<div class="current-trip"> <!-- Current Trip -->
			<h2>Current Trip: <span id="current-trip-name"></span><h2>

			<div> <!-- Location overview -->
				<h4>Location overview: </h4>
				<ul >
          <li class="loc-info">State(s): </li>
            <p class="p_text" id="states"></p>
					<li class="loc-info">Description: </li>
						<p class="p_text" id="des"></p>
          <li class="loc-info">Weather: </li>
  					<p class="p_text" id="weather"></p>


<!--
        	<li>Hours of Operation: </li>
						<ul><li id="hours">7AM-11PM</li></ul>
					<li>Contact Information: </li>
						<ul><li id="contact">(307) 344-7381</li></ul> -->
				</ul>
			</div>

			<div> <!-- Trails Saved -->
				<h4>Saved Trails: </h4>
        <!-- <a href="trail1.html"><div class="saved-trail"> -->
				<a href="saved-trail.html"><div class="saved-trail">
					<img src="https://placekitten.com/330/150">
					<div>Saved Trail #1</div>
				</div></a>
        <!-- <a href="trail2.html"<div class="saved-trail"> -->
				<a href="saved-trail.html"><div class="saved-trail">
					<img src="https://placekitten.com/330/150">
					<div>Saved Trail #2</div>
				</div></a>
			</div>
		</div>

	<hr>

        <!-- Search other locations  -->
        <br/> <br/> <h2> Search other locations </h2>
        <input id="locationBox" type="text" size="20"/>
        <button id="addLocation">Search</button>

			</div>
		</div>

	</div>
</body>

</html>
