<!DOCTYPE html>
<html>

<head>
  <!--This feature is supposed to -->	
  <title>Nature Finder</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/nature-finder.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyBU1zQlcACqaOhTPhsPNyQkh1RYFf2cdYU",
      authDomain: "collegeburnouts.firebaseapp.com",
      databaseURL: "https://collegeburnouts.firebaseio.com",
      projectId: "collegeburnouts",
      storageBucket: "collegeburnouts.appspot.com",
      messagingSenderId: "890814837618"
    };
    firebase.initializeApp(config);
  </script>
</head>

<body>
	<a name="top"></a>

		<!-- SIDEBAR-->
		<div id="sideMenu" class="sidenav">
		  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		  <a href="#">Profile</a>
		  <a href="#">Services</a>
		  <a href="#">Log Out</a>
		</div>  
	  
    	<!-- HEADER -->
		<div class="header">
			<div class="button button-left menu"><span onclick="openNav()"><img id="hamburger" class="icon header" src="img/hamburger-icon.png"></span></div>
			<div class="title">
        		<div id="current-location">Naturous</div>
      		</div>
		</div>

	<hr>

	<!--calling the api link directly, may not work-->
	<!--script src="https://api.everypixel.com/v1/keywords"></script-->
	<!--calling the python file?-->
	<!--div><span id= "naturefinder"><a href="nature-finder.py"></a></div-->
	<!--example code, replace variables. To trigger the ajax when the link is clicked-->
	<!--a href="javascript:keyword"('{{ post.language }}', '{{ g.locale }}', '#post{{ post.id }}', '#translation{{ post.id }}', '#loading{{ post.id }}');"></a>
	<script>
		function keyword(sourceImg, naturefinder, sourceId, destId, loadingId) {
			$(destId).hide();
			//$(loadingId).show();
			$.post('/keyword', {
				text: $(sourceId).text(),
				sourceImg: sourceImg,
				naturefinder: naturefinder
			}).done(function(keyworded) {
				$(destId).text(translated['text'])
				$(loadingId).hide();
				$(destId).show();
			}).fail(function() {
				$(destId).text("{{ _('Error: Could not contact server.') }}");
				$(loadingId).hide();
				$(destId).show();
			});
		}
	</script-->
	<!--jQuery convention for running when the document has been fully loaded-->
	<script type="text/javascript">
		$(document).ready(() => {
			console.log('Ready to accept image')
			const storageService = firebase.storage();
			const storageRef = storageService.ref();
			//sign in user anonymously
			/*firebase.auth().signInAnonymously().then(function() {
				//once sign in completed, we get the download URL of the image
				storageRef.getDownloadURL().then(function(url) {
					//once we have the download URL, we set it to our img element
					document.queryselector('img').src = url;
				}).catch(function(error){
					//if anything goes wrong while getting the download URL, log the error
					console.error(error);
			});*/
			document.querySelector('.insertImage').addEventListener('change', handleFileUploadChange);
			document.querySelector('.analyze').addEventListener('click', handleFileUploadSubmit);

			let selectedFile;
			function handleFileUploadChange(e) {
				selectedFile = e.target.files[0];
			}

			function handleFileUploadSubmit(e) {
				const uploadTask = 
				storageRef.child('').put(selectedFile);

				uploadTask.on('state_changed', (snapshot) => {
	
				}, (error) => {
					console.log(error);
				}, () => {
					//Do something once upload is complete
					console.log('success');
				}
				)
			}

			//function here

			//create a root reference
			/*const storageRef = firebase.storage().ref();
			//Create a reference to example image
			const exampleRef = storageRef.child('26863598b8bec4c49bea8cf6f805002d.jpg');
			//Create a reference to 'images/example'
			const exampleImagesRef = storageRef.child('images/26863598b8bec4c49bea8cf6f805002d.jpg');			
			//File name-- will have to change
			const file = '26863598b8bec4c49bea8cf6f805002d.jpg';
			const metadata = {
				contentType: 'image/jpeg'
			};
			//Upload file and metadata to the object but put isnt a valid firebase command
			const uploadImg = storageRef.child('images/'+ file /*'26863598b8bec4c49bea8cf6f805002d.jpg').put(file, metadata).then(function(snapshot){
				console.log('Uploaded a file!');
			});
			//Listen for state changes, errors, and completion of the upload.
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, //or 'state_changed'
			function(snapshot){
				const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
				console.log('Upload is ' + progress + '% done');
				switch (snapshot.state) {
					case firebase.storage.TaskState.PAUSED: // or 'paused'
						console.log('Upload is paused');
						break;
					case firebase.storage.TaskState.RUNNING: // or 'running'
						console.log('Upload is running');
						break;
				}
				}, function(error) {
					//Handle unsuccessful uploads
					switch (error.code){
						case 'storage/unauthorized':
							//user doesn't have permission to access the object
							break;
						case 'storage/canceled':
							//user canceled the upload
							break;
						case 'storage/unknown':
							//Unknown error occurred. inspect error.serverResponse
							break;
					}
				},
				function() {
					//Handle successful uploads on complete
					uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
						console.log('File available at ', downloadURL);
					});
			}); */
			$('.insertImage').change(function() {
				//coding the interaction, should read url and change the image
				var file = this.files[0];
				var imageFile=file.type;
				var match=["image/jpeg", "image/png", "image/jpg"];

				if (!((imageFile==match[0]) || (imageFile==match[1]) || (imageFile==match[2]))){
					$("#type").text("Only Jpeg/ Jpg/ Png/ Gif are allowed");
					return false;
				}else{
					$("#type").hide();
					//alert("required");
					var reader = new FileReader();
					reader.onload=imageIsLoaded;
					reader.readAsDataURL(this.files[0]);
				}
			});
			function imageIsLoaded(e){
				$("#imageReader").attr('src', e.target.result);
				$("camera").hide();
				$("#imgRead").show();
			}

			$(".analyze").submit(function(e){
				e.preventDefault();
				var formdata = new FormData(this);
				//formdata.append('file', $('#upload)[0].files[0]);
				//showing the uploaded image
				$("").show();
				$.ajax({
					url: 'https://firebasestorage.googleapis.com/v0/b/collegeburnouts/o/',
					type: 'POST',
					data: 'formdata',
					contentType: 'false',
					cache: 'false',
					processData: 'false',
					//dataType: 'json',
					success: (data) => {
					console.log('Accepting image');
					alert(data); 
					//const imgURL = document.querySelector(data).src //probably not using this right
					//$('.Image_Bin').html(imgURL)
					}
				});
			});


			/*$('.analyze').click(() => {
				//bring back the keywords
				$.ajax({
					url: 'https://OWW16mQtRuHeIKf6X0SSDatK:d7AMBj94Jj3VZSWNpuIgd6vsr4lDqqSwwoTSLPYVNrxmuVWN@api.everypixel.com/v1/keywords?url=http://image.everypixel.com/2014.12/67439828186edc79b9be81a4dedea8b03c09a12825b_b.jpg&num_keywords=10',
					type: 'GET',
					dataType: 'json',
					success: (data) => {
						console.log('You got data' + data)
						//display keywords using loop, might have to fix
						for (i=0; i < 10; i++){
						$('.key_tag').html(data)
						}
					}
				})
			})*/
		});
	</script>


	<!-- Side Menu JS -->
	<script>
		function openNav() {
			document.getElementById("sideMenu").style.width = "45%";
		}	
		function closeNav() {
			document.getElementById("sideMenu").style.width = "0";
		}
	</script>

	<div class="page current content">
	<div class="content">
	<div style="width: 400px; height: 400px; border: 1px solid #000;" class="Image_Bin">
	<!--p>Upload your image</p-->
	</div>
	<form action="/upload" method="POST" enctype="multipart/form-data">
		<!--div id="uploadFile">
			<label for="upload" title="Upload photo" class="camera"></label>
			<label for="upload">
				<img id="imageReader">
			</label>
			<input type="file" name="file" required id="upload">
		</div-->
		<input type="file" accept="image/*" class="insertImage">
		<input type="submit" value="Upload" class="analyze">
	</form>
	<!--script>
		function display(sw) {
			var pic;
			if (sw == 1){

			}
		}
	</script-->
	<!--keywords should be displayed here-->
	<div class="keyWords">
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
		<li class="key">
			<span class="key_tag"></span>
		</li>
	</div>
	<!-- Make sure this is at the bottom always:
       Allows space between last thing on the page and navbar -->
	<div class="clear"></div>
	<!-- Navbar -->
	<div class="navbar">
			<a href="index.html"><img src="https://img.icons8.com/ios/40/000000/home-page.png"></a>
			<a href="map.html"><img src="https://img.icons8.com/wired/40/000000/map.png"></a>
			<a href="trail-list.html"><img src="https://img.icons8.com/ios/40/000000/earth-element.png"></a>
			<a href="nature-finder.html" class="active"><img src="https://img.icons8.com/wired/43/000000/leaf.png"></a>
	</div>
	</div>
	</div>
</body>

</html>
